{%- assign _category_max_size = 1 -%}
{%- assign _category_min_size = 1 -%}
{%- assign _category_cur_size = 1 -%}
{%- assign _categories = site.categories | sort -%}
{%- for _category in _categories -%}
  {%- assign _category_cur_size = _category.last.size -%}
  {%- if _category_cur_size > _category_max_size -%}
    {%- assign _category_max_size = _category_cur_size -%}
  {%- endif -%}
  {%- if _category_cur_size < _category_min_size -%}
    {%- assign _category_min_size = _category_cur_size -%}
  {%- endif -%}
{%- endfor -%}
{%- assign _category_gap_size =  _category_max_size | minus: _category_min_size | plus: 1 | divided_by: 4 -%}
{%- if _category_gap_size < 1 -%}
  {%- assign _category_gap_size = 1 -%}
{%- endif -%}
<div class="site-categories js-categories">
  <ul class="menu">
    <li>
      <button type="button" class="button button-secondary button-pill category-button category-button-all" data-encode="">
        Show All<div class="category-button-count">{{ site.posts | size }}</div>
      </button>
    </li>
    {%- for _category in _categories -%}
      {%- assign _category_cur_size = _category.last.size -%}
      {%- assign _category_min_1 = _category_min_size -%}
      {%- assign _category_max_1 = _category_min_1 | plus: _category_gap_size -%}
      {%- assign _category_min_2 = _category_max_1 -%}
      {%- assign _category_max_2 = _category_min_2 | plus: _category_gap_size -%}
      {%- assign _category_min_3 = _category_max_2 -%}
      {%- assign _category_max_3 = _category_min_3 | plus: _category_gap_size -%}
      {%- assign _category_min_4 = _category_max_3 -%}
      {%- assign _category_max_4 = _category_min_4 | plus: _category_gap_size -%}
      {%- if _category_cur_size >= _category_min_1 and _category_cur_size < _category_max_1 -%}
        {%- assign _c_index = 1 -%}
      {%- elsif _category_cur_size >= _category_min_2 and _category_cur_size < _category_max_2 -%}
        {%- assign _c_index = 2 -%}
      {%- elsif _category_cur_size >= _category_min_3 and _category_cur_size < _category_max_3 -%}
        {%- assign _c_index = 3 -%}
      {%- elsif _category_cur_size >= _category_min_4 and _category_cur_size < _category_max_4 -%}
        {%- assign _c_index = 4 -%}
      {%- else -%}
        {%- assign _c_index = 4 -%}
      {%- endif -%}
      <li>
        <button type="button" class="button button-pill category-button category-button-{{ _c_index }}" data-encode="{{ _category.first | strip | url_encode }}">
          <span>[ {{ _category.first | strip }} ]</span><div class="category-button-count">{{ _category.last.size }}</div>
        </button>
      </li>
    {%- endfor -%}
  </ul>
</div>
